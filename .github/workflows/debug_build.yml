name: Debug build

on:
  workflow_dispatch:
    inputs:
      buildType:
        description: "Build type"
        required: false
        default: 'debug'
        type: choice
        options:
          - debug
          - release
      branchName:
        description: "Branch name"
        required: false
        default: 'development'


jobs:
  build:
    runs-on: ubuntu-latest


    env:
      BUILD_TYPE: ${{inputs.buildType}}
      APK_NAME_DEBUG: app-debug.apk
      APK_NAME_RELEASE: app-release.apk
      APK_FILE_PATH_DEBUG: app/build/outputs/apk/debug/app-debug.apk
      APK_FILE_PATH_RELEASE: app/build/outputs/apk/release/app-debug.apk


    steps:
    - name: Checkout to branch
      if: inputs.branchName != ${{ github.ref_name }}
      uses: actions/checkout@v3
      with:
        ref: ${{inputs.branchName}}

    - name: Setup file name
      uses: haya14busa/action-cond@v1
      id: apkFilename
      with:
        cond: $BUILD_TYPE == 'release'
        if_true: ${{ env.APK_NAME_RELEASE}}
        if_false: ${{ env.APK_NAME_DEBUG}}

    - name: Setup file path
      uses: haya14busa/action-cond@v1
      id: apkFilepath
      with:
        cond: $BUILD_TYPE == 'release'
        if_true: ${{ env.APK_FILE_PATH_RELEASE}}
        if_false: ${{ env.APK_FILE_PATH_DEBUG}}

    - name: Use conditional value
      run: |
        echo "${{ steps.apkFilepath.outputs.value }}"
        echo "${{ inputs.branchName }}"
    

#    - name: set up JDK 11
#      uses: actions/setup-java@v3
#      with:
#        java-version: '11'
#        distribution: 'temurin'
#        cache: gradle
#
#    - name: Grant execute permission for gradlew
#      run: chmod +x gradlew
#
#    - name: Build with Gradle
#      run: |
#        if [$BUILD_TYPE == 'debug']; then
#          ./gradlew assembleDebug
#        else
#          ./gradlew assembleRelease
#        fi
#
#    - name: Upload APK
#      uses: actions/upload-artifact@v2
#      with:
#        name: ${{ steps.apkFilename.outputs.value }}
#        path: ${{ steps.apkFilepath.outputs.value }}
